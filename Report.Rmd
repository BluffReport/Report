---
title: "**Erosion Susceptibility of Boston Harbor Bluffs**"
author:
  - Teaching Fellow - Minh Thu Bui
  - Supervisor - Professor Masanao Yajima
  - Yingmai Chen, Maysen Pagan, Chang Shi, Yan Wang
output: pdf_document
---
```{r, echo = FALSE}
#libraries
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(tidyr))
suppressPackageStartupMessages(library(ggplot2))
library(philentropy)
library(cluster)
library(pheatmap)
library(ggpubr)
```

# Project Background

# Objectives

# Exploratory Data Analysis

## Data Cleaning and Organizing 
```{r, echo = FALSE}
#loading and cleaning data
data <- read.csv("erosion_vulnerability.csv")
colnames(data) <- c("bluff", "orientation", "rr", "vulnerability", "wave.height", "max.wave.height", "mud.comp", "base.el", "bluff.el", "seawall")
#remove rows/bluffs with no erosion rate data
data <- data %>% drop_na()
```

```{r, echo = FALSE}
#remove vulnerability for our analysis
bluffs <- data[,-4]
#scale numeric columns
bluffs[,2:8] <- scale(bluffs[,2:8])
```

## Data Exploration

We begin the data exploration by observing the relationship and patterns between the orientation of the bluff and the presence of a seawall with the retreat rates of the bluffs. Figure 1 demonstrates this relationship on a polar plot. \

```{r polar-plot, echo = FALSE, fig.cap="Polar plot of bluff orientation against retreat rate."}

data %>% ggplot(aes(orientation, rr, col = as.factor(seawall))) + geom_point(alpha=0.5) +
  labs(x = "Degree Orientation",
       y = "Retreat Rate (m/yr)", 
       title = "Orientation vs. Erosion Rates") +
  #theme_bw() +
  theme(axis.title = element_text(size = 14),
        axis.text = element_text(size = 12), 
        plot.title = element_text(size = 16),
        legend.text = element_text(size = 12)
        ) + 
  scale_color_manual(values = c("#587090", "#ff6380"),
                    name = "Seawall Presence") +
  coord_polar() +
  scale_x_continuous(limits = c(0,360),
                     breaks = seq(0, 360, by = 45),
                     minor_breaks = seq(0, 360, by = 15))
```

It appears that more bluffs that face East and therefore have lower degrees of orientation also have a seawall present. This intuitively makes sense as those bluffs with lower degrees of orientation face the mouth of the harbor and are more likely to have a seawall with the intentions of preventing erosion. We can also see that those bluffs with orientations less than 180 degrees tend to have higher retreat rates than those bluffs with orientations between 180 and 360 degrees.

# Models

The method used to group the bluffs based on similar characteristics and compare susceptibility to erosion involves visualizing a multidimensional scaling plot and heatmap with hierarchical clusterings of the bluffs. These clusterings are determined by the "distances" between each bluff.

## Bluff Distances {#sec-distances}

Defining a distance between bluffs provides a measure of dissimilarity between each bluff. Variables for each of the bluffs included seven numerical variables as well as one binary or categorical variable (seawall presence). Not all of the variables are numeric and as a result, the Gower's distance is calculated between two bluffs which accounts for both numerical and categorical variables.

Gower's distance calculates a matrix of dissimilarities for each of the $\frac{n(n-1)}{2} = \frac{31(31-1)}{2} = 465$ pairs of bluffs. This method combines the Manhattan distance for numerical variables and Hamming loss for categorical variables to get the total distance between two observations. For the seven numerical variables, a range-normalized Manhattan distance is calculated: $$|\frac{T_{ik} - T_{jk}}{\text{range}_k}|$$ where $i, j = 1, 2, \dots, 22$ and $k = 1, 2, \dots, 7$. For the remaining categorical variable, the Hamming loss is calculated with the following formula: $$I(T_{i,seawall} \neq T_{j,seawall})$$ where $i, j = 1, 2, \dots, 22$. This indicator will equal 1 if $T_{i,seawall} \neq T_{j,seawall}$ and 0 if $T_{i,seawall} \neq T_{j,seawall}$. Gower's distance between two bluffs is calculated by summing these variable distances and dividing by 8, the total number of variables.

## Multidimensional Scaling

Once we have the pairwise distances between bluffs from the data, multidimensional scaling provides one method of visualizing the clusters and their distances from each other on a two dimensional plot. Although the data for each bluff is multivariate, multidimensional scaling preserves the distances between pairwise observations when plotting. Multidimensional scaling takes in the calculated distances and returns a set of 31 points where the distances between each point is approximately equal to the dissimilarities between each point. These points are then plotted on a two dimensional scatter plot to visualize the "closeness" of the bluffs and can be viewed in Figure 2.

```{r mds-plot, echo = FALSE, warning = FALSE, fig.cap="Multidimensional scaling plot of 31 bluffs."}
#multidimensional scaling
gower_samples <- as.dist(as.matrix(daisy(bluffs[,2:9], metric = "gower")))
gower_features <- as.dist(as.matrix(daisy(t(bluffs[,2:9]), metric = "gower")))

mds <- gower_samples %>% 
  cmdscale() %>%
  as_tibble()

mds <- as.data.frame(mds)

colnames(mds) <- c("Dimension 1", "Dimension 2")
ggscatter(mds, x = "Dimension 1", y = "Dimension 2", 
          label = c("Bumpkin 1", "Bumpkin 2", "Gallops 1", "GB 1", "GB 2", "GB 3", "GB 4", 
                        "Georges 1", "Georges 2", "Long 2", "Long 1", "Long 3", "Lovells 1", "Lovells 2",
                        "Moon 1", "Moon 2", "Peddocks 1", "Peddocks 2", "Peddocks 3", "Peddocks 4", 
                        "Peddocks 5", "Peddocks 6", "Peddocks 7", "Peddocks 8", "Rainsford 1", "Thompson 1",
                        "Thompson 3", "Thompson 4", "Thompson 2", "Webb 1", "Webb 2"),
          font.label = 9,
          size = 1,
          repel = TRUE, 
          title = "Multidimensional Scaling Plot") +
  theme_bw() +
  theme(axis.title = element_text(size = 14),
        plot.title = element_text(size = 16),
        )


```

## Heatmap

We can also use a heatmap to visually identify similarities and dissimilarities between bluffs. In a heatmap cells are color-coded to quickly compare one row or blff to another. The heatmap also allows one to aggregate the rows in clusters based on the distances calculated from @sec-distances. Figure 3 below is the heatmap generated for the 31 bluffs using Gower's distance.

```{r heatmap-plot, echo = FALSE, warning = FALSE, fig.cap="Clustered heatmap of 31 bluffs."}
#heatmap

pheatmap(bluffs[,2:9], 
                    display_numbers = TRUE, 
                    clustering_distance_rows=gower_samples,
                    clustering_distance_cols=gower_features,
                    angle_col = 3,
                    fontsize = 6,
                    cellheight = 5.6,
                    cellwidth = 13.5,
         labels_row = c("Bumpkin 1", "Bumpkin 2", "Gallops 1", "GB 1", "GB 2", "GB 3", "GB 4", 
                        "Georges 1", "Georges 2", "Long 2", "Long 1", "Long 3", "Lovells 1", "Lovells 2",
                        "Moon 1", "Moon 2", "Peddocks 1", "Peddocks 2", "Peddocks 3", "Peddocks 4", 
                        "Peddocks 5", "Peddocks 6", "Peddocks 7", "Peddocks 8", "Rainsford 1", "Thompson 1",
                        "Thompson 3", "Thompson 4", "Thompson 2", "Webb 1", "Webb 2"),
         labels_col = c("Orientation", "Retreat Rate", "Wave Height", "Max Wave Height", "Mud Composition",
                        "Base Elevation", "Bluff Elevation", "Seawall")
                    )
```

# Analysis and Conclusion

# Appendix












