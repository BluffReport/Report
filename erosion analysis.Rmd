---
title: "analysis for erosion"
author: "Yingmai Chen,Yan Wang"
date: "2023-11-27"
output:
  html_document:
    df_print: paged
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(tidyverse)
library(readr)
library(gridExtra)
library(car)
library(grid)
```

```{r}
erosion<-read.csv("erosion.csv")
```

### linear regression for all variables(MAX waveheight)

```{r}
stan <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}
data <- read_csv("erosion.csv")
names(data) <- gsub(" ", "_", names(data))
names(data) <- gsub("\\(", "", names(data))
names(data) <- gsub("\\)", "", names(data))
names(data) <- gsub("/", "_per_", names(data))
names(data) <- gsub("%", "percent", names(data))
if ("RR (m/yr)" %in% names(data)) {
  names(data)[names(data) == "RR (m/yr)"] <- "RR_m_per_yr"
}
numeric_columns <- sapply(data, is.numeric) & names(data) != "RR_m_per_yr"
data[numeric_columns] <- lapply(data[numeric_columns], stan)
predictors <- setdiff(names(data), c("Bluff", "RR_m_per_yr"))
target <- "RR_m_per_yr"
model_formula <- as.formula(paste(target, "~", paste(predictors, collapse = " + ")))
model1 <- lm(model_formula, data = data)
print(summary(model1))
predictions <- predict(model1, data)
mse <- mean((data[[target]] - predictions)^2)
rsquared <- summary(model1)$r.squared
cat("(MSE):", mse, "\n")
cat("R square:", rsquared, "\n")

```

### check

```{r}


residuals <- residuals(model1)
fitted_values <- fitted(model1)

ggplot() +
  geom_point(aes(x = fitted_values, y = residuals)) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  xlab("Fitted Values") +
  ylab("Residuals") +
  ggtitle("Residuals vs Fitted")

qqnorm(residuals)
qqline(residuals, col = "red")


data$Predicted_RR <- predictions


ggplot(data, aes(x = Predicted_RR, y = RR_m_per_yr)) +
  geom_point() +  # Add points
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") + 
  labs(x = "Predicted RR (m/yr)", y = "Actual RR (m/yr)", title = "Actual vs Predicted RR") +
  theme_minimal()


```

### linear regression for all variables(MAX waveheight nne 15m/s)


```{r}
stan <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}
data <- read_csv("erosionnne15.csv")
names(data) <- gsub(" ", "_", names(data))
names(data) <- gsub("\\(", "", names(data))
names(data) <- gsub("\\)", "", names(data))
names(data) <- gsub("/", "_per_", names(data))
names(data) <- gsub("%", "percent", names(data))
if ("RR (m/yr)" %in% names(data)) {
  names(data)[names(data) == "RR (m/yr)"] <- "RR_m_per_yr"
}
numeric_columns <- sapply(data, is.numeric) & names(data) != "RR_m_per_yr"
data[numeric_columns] <- lapply(data[numeric_columns], stan)
predictors <- setdiff(names(data), c("Bluff", "RR_m_per_yr"))
target <- "RR_m_per_yr"
model_formula <- as.formula(paste(target, "~", paste(predictors, collapse = " + ")))
model2 <- lm(model_formula, data = data)
print(summary(model2))
predictions <- predict(model2, data)
mse <- mean((data[[target]] - predictions)^2)
rsquared <- summary(model2)$r.squared
cat("(MSE):", mse, "\n")
cat("R square:", rsquared, "\n")

```


### check

```{r}
# 1.residual vs fitted
residuals <- residuals(model2)
fitted_values <- fitted(model2)

ggplot() +
  geom_point(aes(x = fitted_values, y = residuals)) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  xlab("Fitted Values") +
  ylab("Residuals") +
  ggtitle("Residuals vs Fitted")

# 2. Q-Q Plot for Normal Distribution of Residuals
qqnorm(residuals)
qqline(residuals, col = "red")



# 3.actual with fitted
data$Predicted_RR <- predictions


ggplot(data, aes(x = Predicted_RR, y = RR_m_per_yr)) +
  geom_point() +  # Add points
  geom_abline(intercept = 0, slope = 1, color = "red", linetype = "dashed") +  # Add a 45-degree line
  labs(x = "Predicted RR (m/yr)", y = "Actual RR (m/yr)", title = "Actual vs Predicted RR") +
  theme_minimal()

```



