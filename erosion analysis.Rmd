---
title: "analysis for erosion"
author: "Yingmai Chen,Yan Wang"
date: "2023-11-27"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(ggplot2)
library(tidyverse)
```

```{r}
erosion<-read.csv("erosion.csv")
```

### linear regression for all variables(MAX waveheight)

```{r}
library(readr)
stan <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}
data <- read_csv("erosion.csv")
names(data) <- gsub(" ", "_", names(data))
names(data) <- gsub("\\(", "", names(data))
names(data) <- gsub("\\)", "", names(data))
names(data) <- gsub("/", "_per_", names(data))
names(data) <- gsub("%", "percent", names(data))
if ("RR (m/yr)" %in% names(data)) {
  names(data)[names(data) == "RR (m/yr)"] <- "RR_m_per_yr"
}
numeric_columns <- sapply(data, is.numeric) & names(data) != "RR_m_per_yr"
data[numeric_columns] <- lapply(data[numeric_columns], stan)
predictors <- setdiff(names(data), c("Bluff", "RR_m_per_yr"))
target <- "RR_m_per_yr"
model_formula <- as.formula(paste(target, "~", paste(predictors, collapse = " + ")))
model1 <- lm(model_formula, data = data)
print(summary(model1))
predictions <- predict(model1, data)
mse <- mean((data[[target]] - predictions)^2)
rsquared <- summary(model1)$r.squared
cat("(MSE):", mse, "\n")
cat("R square:", rsquared, "\n")

```

### check

```{r}
plot(model1, which = 1)
ggplot(data, aes_string(x = "fitted(model1)", y = "resid(model1)")) +
  geom_point() +
  geom_hline(yintercept = 0, linetype = "dashed") +
  xlab("Fitted values") +
  ylab("Residuals") +
  ggtitle("Residuals vs Fitted")
plot(model1, which = 2)
ggplot(data, aes_string(sample = "rstandard(model1)")) +
  stat_qq() +
  stat_qq_line() +
  ggtitle("Normal Q-Q Plot of Standardized Residuals")

fitted_values <- fitted(model1)
ggplot(data, aes(x = fitted_values, y = data[[target]])) +
  geom_point() +  # Plot actual vs. fitted values
  geom_abline(slope = 1, intercept = 0, color = "red", linetype = "dashed") +
  xlab("Fitted Values") +
  ylab("Actual Values") +
  ggtitle("Comparison of Fitted and Actual Values")
```

### linear regression for all variables(MAX waveheight nne 15m/s)


```{r}
stan <- function(x) {
  return((x - min(x)) / (max(x) - min(x)))
}
data <- read_csv("erosionnne15.csv")
names(data) <- gsub(" ", "_", names(data))
names(data) <- gsub("\\(", "", names(data))
names(data) <- gsub("\\)", "", names(data))
names(data) <- gsub("/", "_per_", names(data))
names(data) <- gsub("%", "percent", names(data))
if ("RR (m/yr)" %in% names(data)) {
  names(data)[names(data) == "RR (m/yr)"] <- "RR_m_per_yr"
}
numeric_columns <- sapply(data, is.numeric) & names(data) != "RR_m_per_yr"
data[numeric_columns] <- lapply(data[numeric_columns], stan)
predictors <- setdiff(names(data), c("Bluff", "RR_m_per_yr"))
target <- "RR_m_per_yr"
model_formula <- as.formula(paste(target, "~", paste(predictors, collapse = " + ")))
model2 <- lm(model_formula, data = data)
print(summary(model2))
predictions <- predict(model2, data)
mse <- mean((data[[target]] - predictions)^2)
rsquared <- summary(model2)$r.squared
cat("(MSE):", mse, "\n")
cat("R square:", rsquared, "\n")

```


### check

```{r}
residuals <- residuals(model2)
fitted_values <- fitted(model2)

ggplot() +
  geom_point(aes(x = fitted_values, y = residuals)) +
  geom_hline(yintercept = 0, linetype = "dashed") +
  xlab("Fitted Values") +
  ylab("Residuals") +
  ggtitle("Residuals vs Fitted")

# 2. Q-Q Plot for Normal Distribution of Residuals
qqnorm(residuals)
qqline(residuals, col = "red")
```




### factor analysis for nominal variable

```{r}
data <- read.csv("erosion.csv")
data$Seawall <- factor(data$Seawall)
model <- lm(`RR..m.yr.` ~ Seawall, data = data)
summary(model)
ggplot(data, aes(x = Seawall, y = `RR..m.yr.`)) +
  geom_boxplot() +
  labs(title = "Effect of Seawall on RR (m/yr)", x = "Seawall", y = "RR (m/yr)")

```
